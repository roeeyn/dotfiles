#!/bin/bash
set -e

# After brew installed goes here!

echo "Installing Python dependencies..."
pip3 install rogit wakatime black aactivator pynvim ansible-lint[community,yamllint]

echo "Installing NPM global dependencies..."
npm i -g prettier pyright bash-language-server ansible-language-server

if test -f $HOME/.ssh/id_rsa.pub; then
    pbcopy < ~/.ssh/id_rsa.pub
    echo "Detected ssh key, copied to clipboard"
else
    echo "Generating SSH key"
    ssh-keygen -t rsa -b 4096 -C "rodrigo.medina.neri@gmail.com"
    eval "$(ssh-agent -s)"
    echo "Host *
    AddKeysToAgent yes
    UseKeychain yes
    IdentityFile ~/.ssh/id_rsa" > ~/.ssh/config
    ssh-add -K ~/.ssh/id_rsa
    pbcopy < ~/.ssh/id_rsa.pub
    echo "Finished, SSH key copied to clipboard"
fi

## Install Oh My Zsh
if [ ! -d "$HOME/.oh-my-zsh" ]; then
    echo "Installing oh my zsh..."
    # Oh My Zsh installing script
    sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)" &

    # OMZ plugins
    git clone https://github.com/zsh-users/zsh-docker.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-docker
    git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions
    git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting

    # Tmux package manager
    git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

    # Install Plug (Vim package manager)
    sh -c 'curl -fLo "${XDG_DATA_HOME:-$HOME/.local/share}"/nvim/site/autoload/plug.vim --create-dirs https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim'

    # Intall TabNine
    git clone --depth 1 https://github.com/codota/tabnine-vim ~/tabnine-vim


    # Installing powerlevel10k
    git clone --depth=1 https://github.com/romkatv/powerlevel10k.git ${ZSH_CUSTOM:-$HOME/.oh-my-zsh/custom}/themes/powerlevel10k

else
    echo "Detected oh my zsh installation... skipping it"
fi
